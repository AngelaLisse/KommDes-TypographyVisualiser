<!Doctype html>
<html>
<head>
    <title>Home</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">  <!-- &lt;!&ndash; In Flask müssen css Dateien in dem Ordner static sein. Hier wird dann die Referenz gelegt &ndash;&gt; -->

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

</head>
<body>
    <main>
        <section id="content header">
            <h1>Typography Visualiser</h1>
            <p id="log">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd
            </p>
            <form method="post", id="form">
                <label for="searchbar">Suchbegriff: </label>
                <input type="text" id="searchbar" />
                <br />
                <label for="imageAmount">Anzahl an Bildern: </label>
                <input type="number" id="imageAmount" />
                <input type="submit" value="Suchen" />

{#                <input type="color" id="colorPicker" />#}
            </form>
        </section>

        <section id="images">
            <p>Hello </p>
            <form id="formImages">
                <input type="submit" id="continue" />
            </form>
        </section>
    </main>

    <script>
        let keyword = "";
        $('#form').on('submit', event => {
            keyword = $('#searchbar').val();                                        // Inhalte der Eingabefelder zwischenspeichern
            let amount = $('#imageAmount').val();
            //let color = $('#colorPicker').val();
            event.preventDefault();                                                 // Standard HTML form-post unterbrechen, da wir ajax nutzen
            $.ajax({
                url: "/DownloadImages",                                             // Ziel festlegen (in main.py als app.route gesetzt)
                data: {'keyword': keyword, 'amount': amount},                       // Nutzereingabe einpacken
                method: 'POST'
            })
            .done(data => {                                                         // Was soll passieren, wenn search() zuende ist
                //window.location.href = "/Settings";

                // Anzahl an Bildern bekommen wir am Ende des downloads mitgeteilt.
                // Für jedes runtergeladene Bild soll jetzt ein img-tag erstellt
                // und das src-Attribut mit dem Pfad zum Bild gefült werden
                // TODO: Pfad schöner zusammenbinden
                for (let i = 0; i < data.amount; i++) {
                    let filename = "{{ url_for('static', filename='images') }}".concat('/')
                        .concat(keyword)
                        .concat('/')
                        .concat(keyword)
                        .concat('-')
                        .concat(i.toString())
                        .concat('.jpg');
                            // ^ Ew...

                    $("<img>").attr("src", filename).appendTo("#images");
                }
            })
        });

        // redirect funktioniert aus unbekannten Gründen nicht.
        // Wenn das selbe oben aufgerufen wird, gehts
        $('#formImages').on('submit', event => {
            console.log("Redirect to settings");
            window.location.href = "/Settings";
        })
    </script>
</body>
</html>